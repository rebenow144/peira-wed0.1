<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Sensor Data</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background-color: #f4f4f4;
    }
    h2 {
      margin-top: 2rem;
      color: #2c3e50;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      margin-bottom: 2rem;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #2c3e50;
      color: white;
    }
    td {
      text-align: center;
    }
    .timestamp {
      text-align: left;
      font-weight: bold;
      background-color: #eef;
    }
  </style>
</head>
<body>
  <h2>üîÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå (CSV)</h2>
  <table id="sensor-table">
    <thead>
      <tr id="table-head"></tr>
    </thead>
    <tbody>
      <tr id="table-body"></tr>
    </tbody>
  </table>

  <h2>üìä ‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (Min / Max / Avg) ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
  <table id="summary-table">
    <thead>
      <tr>
        <th>Field</th>
        <th>Min</th>
        <th>Max</th>
        <th>Avg</th>
      </tr>
    </thead>
    <tbody id="summary-body"></tbody>
  </table>

  <script>
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    async function fetchLatest() {
      try {
        const res = await fetch('http://localhost:3000/latest');
        const data = await res.json();

        const headRow = document.getElementById('table-head');
        const bodyRow = document.getElementById('table-body');

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
        if (headRow.childElementCount === 0) {
          Object.keys(data).forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headRow.appendChild(th);
          });
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        bodyRow.innerHTML = '';
        Object.values(data).forEach(val => {
          const td = document.createElement('td');
          td.textContent = val;
          bodyRow.appendChild(td);
        });

      } catch (err) {
        console.error('‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', err);
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    async function fetchSummary() {
      try {
        const res = await fetch('http://localhost:3000/latest-summary');
        const data = await res.json();

        const tbody = document.getElementById('summary-body');
        tbody.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        const timeRow = document.createElement('tr');
        const timeCell = document.createElement('td');
        timeCell.textContent = `‚è∞ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤: ${data.time}`;
        timeCell.colSpan = 4;
        timeCell.classList.add('timestamp');
        timeRow.appendChild(timeCell);
        tbody.appendChild(timeRow);

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡∏•‡∏∞ field
        for (const field in data.stats) {
          const stat = data.stats[field];
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${field}</td>
            <td>${stat.min}</td>
            <td>${stat.max}</td>
            <td>${stat.avg}</td>
          `;
          tbody.appendChild(tr);
        }

      } catch (err) {
        console.error('‚ùå ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', err);
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    setInterval(() => {
      fetchLatest();
      fetchSummary();
    }, 1000);

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    fetchLatest();
    fetchSummary();
  </script>
</body>
</html>
